pipeline {
    agent any 

    environment {
        BRANCH_NAME = "${env.BRANCH_NAME}" // Obtiene la rama actual
    }

    stages {

        stage('Checkout') {
            steps {
                script {
                    echo "Ejecutando pipeline para la rama: ${BRANCH_NAME}"
                }
                checkout scm
            }
        }

        stage('Run CI/CD') {
            steps {
                script {
                    def pipelineScript = ''

                    if (BRANCH_NAME == 'develop') {
                        echo "Ejecutando CI para develop"
                        pipelineScript = 'Jenkinsfile'
                    } else if (BRANCH_NAME == 'master') {  // Aseg√∫rate de usar "master" si es correcto
                        echo "Ejecutando CD para master"
                        pipelineScript = 'Jenkinsfile'
                    } else {
                        error "‚ùå Rama no soportada: ${BRANCH_NAME}. Abortando pipeline."
                    }

                    // Verificar si el archivo Jenkinsfile existe antes de cargarlo
                    if (fileExists(pipelineScript)) {
                        echo "üìÑ Cargando y ejecutando ${pipelineScript}"
                        load pipelineScript
                    } else {
                        error "‚ùå No se encontr√≥ el archivo ${pipelineScript}. Abortando pipeline."
                    }
                }
            }
        }
    }
}
